<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kingshot Leaderboard</title>
<style>
  body {
    background: linear-gradient(180deg, #ffffff 0%, #f5f5f5 100%);
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    color: #111;
    margin: 0;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }

  h1 {
    color: #00bcd4;
    text-shadow: 0 0 8px rgba(0, 255, 255, 0.4);
    margin-bottom: 1rem;
    font-size: 1.6rem;
  }

  .leaderboard {
    width: 100%;
    max-width: 960px;
    background: rgba(255, 255, 255, 0.97);
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.12);
    overflow: hidden;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  thead th {
    background: rgba(0, 255, 255, 0.08);
    color: #055;
    padding: 10px 12px;
    text-align: left;
    font-weight: 700;
    font-size: 0.9rem;
    white-space: nowrap;
  }

  td {
    padding: 10px 12px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    font-size: 0.9rem;
    vertical-align: top;
  }

  tr:hover {
    background: rgba(0, 255, 255, 0.04);
  }

  .rank {
    color: #00bcd4;
    font-weight: 700;
    white-space: nowrap;
  }

  /* Player name defaults */
  .player {
    color: #111;
  }
  .player.p99 {
    color: #00e5ff;
    text-shadow: 0 0 6px #80deea;
    font-weight: 700;
  }
  .player.p95 {
    color: #9c27b0;
    text-shadow: 0 0 6px #d35fe7;
    font-weight: 700;
  }

  .score {
    white-space: nowrap;
    font-variant-numeric: tabular-nums;
  }

  /* Weekly increase % colors */
  .increase {
    font-weight: 700;
    white-space: nowrap;
  }
  .increase.p99 { color: #00e5ff; text-shadow: 0 0 6px #80deea; }
  .increase.p95 { color: #9c27b0; text-shadow: 0 0 6px #d35fe7; }
  .increase.p75 { color: #00c853; text-shadow: 0 0 4px #69f0ae; }
  .increase.p50 { color: #000000; text-shadow: 0 0 1px #ffffff; }
  .increase.p25 { color: #f44336; text-shadow: 0 0 3px #ff8a80; }

  .remark {
    color: #333;
    font-size: 0.88rem;
    line-height: 1.35;
    white-space: normal;
  }

  @media (max-width: 720px) {
    tr {
      display: flex;
      flex-wrap: wrap;
      padding: 8px;
      border-bottom: 1px solid rgba(0,0,0,0.06);
    }
    td {
      flex: 1 1 45%;
      min-width: 120px;
      padding: 6px 8px;
    }
    td.remark {
      flex-basis: 100%;
      margin-top: 6px;
    }
    td.remark::before {
      content: "üí¨ ";
      color: #00bcd4;
      font-weight: 700;
    }
  }

  @media (max-width: 420px) {
    td { flex-basis: 100%; }
  }
</style>
</head>
<body>
  <h1>üèÜ Kingshot Weekly Leaderboard</h1>
  <div class="leaderboard">
    <table id="board">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Player</th>
          <th>Score (W1)</th>
          <th>Score (W2)</th>
          <th>Increase %</th>
          <th>Remarks</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
(async function(){
  try {
    const resp = await fetch('leaderboard.json', { cache: 'no-store' });
    const data = await resp.json();

    const increases = data.map(p => {
      let raw = p["weekly_increase %"] ?? p.weekly_increase ?? "";
      if (typeof raw === "string") raw = raw.replace(",", ".");
      const n = parseFloat(raw);
      return isFinite(n) ? n : NaN;
    });

    const valid = increases.filter(v => !isNaN(v)).sort((a,b)=>a-b);

    function percentileOf(value) {
      if (isNaN(value)) return 0;
      const index = valid.findIndex(v => v >= value);
      const rank = index === -1 ? valid.length : index + 1;
      return (rank / valid.length) * 100;
    }

    function pctClass(value) {
      const pct = percentileOf(value);
      if (pct >= 99) return 'p99';
      if (pct >= 95) return 'p95';
      if (pct >= 75) return 'p75';
      if (pct >= 50) return 'p50';
      return 'p25';
    }

    function formatScore(val) {
      if (!val) return '';
      if (typeof val === 'number') return val.toLocaleString('de-DE');
      const parsed = parseFloat(val.toString().replace(/\./g,'').replace(',', '.'));
      return isNaN(parsed) ? val : parsed.toLocaleString('de-DE');
    }

    const tbody = document.querySelector('#board tbody');
    tbody.innerHTML = '';

    data.forEach((p, i) => {
      const increase = increases[i];
      const incDisplay = isNaN(increase) ? '-' : increase.toFixed(2).replace('.', ',') + '%';
      const incClass = pctClass(increase);
      const nameClass = ['p99', 'p95'].includes(incClass) ? incClass : '';

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="rank">#${p.rank ?? ''}</td>
        <td class="player ${nameClass}">${escapeHtml(p.player_name ?? '')}</td>
        <td class="score">${formatScore(p.score_week1)}</td>
        <td class="score">${formatScore(p.score_week2)}</td>
        <td class="increase ${incClass}">${incDisplay}</td>
        <td class="remark">${escapeHtml(p.remarks ?? p.Remarks ?? '‚Äî')}</td>
      `;
      tbody.appendChild(tr);
    });

  } catch (err) {
    console.error('Error loading leaderboard:', err);
    const tbody = document.querySelector('#board tbody');
    tbody.innerHTML = `<tr><td colspan="6" style="padding:12px;color:#666;">Could not load leaderboard.json ‚Äî check console.</td></tr>`;
  }

  function escapeHtml(s) {
    return String(s)
      .replace(/&/g,'&amp;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;');
  }
})();
</script>
</body>
</html>
